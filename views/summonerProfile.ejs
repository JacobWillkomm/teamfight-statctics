<%- include('partials/header') -%>
<div class="container">
  <div class="row mt-5">
    <div class="row">
      <div class="col-3">
          <div class="mt-5">
            <h2 class="main-color"><%= summoner[0].summonerName %></h2>
            <form action="/summoner/<%= summoner[0].summonerName %>/importMatches" enctype="multipart/form-data" method="POST">
              <button type="submit" class="btn btn-primary main-color-bg" value="submit">Import New Matches</button>
            </form>
          </div>
      </div>
      <div class ="col-9">
        <div class="mt-5 profile-stats">
          <ul>
            <li>
              <h3><%= ((stats.wins/stats.games)*100).toFixed(2) %></h3>
              <ul class="sub-stats">
                <li><%= ((stats.winsNormal/stats.normalGames)*100).toFixed(2) %></li>
                <li><%= ((stats.winsRanked/stats.rankedGames)*100).toFixed(2) %></li>
              </ul>
              <h5>Top 4 Win %</h5>
            </li>
            <li>
              <h3><%= ((stats.totalPlacement/stats.games)).toFixed(2) %></h3>
              <ul class="sub-stats">
                <li><%= ((stats.totalPlacementNormal/stats.normalGames)).toFixed(2) %></li>
                <li><%= ((stats.totalPlacementRanked/stats.rankedGames)).toFixed(2) %></li>
              </ul>
              <h5>Avg. Rank</h5>
            </li>
            <li>
              <h4>Top Traits</h4>
              <% if(stats.traitArray.length > 2) { %>
              <ul class="top-traits">
                <li><img src="../imgs/traits/bard.png"><%= stats.traitArray[0][0].split('_')[1] %></li>
                <li><img src="../imgs/traits/evoker.png"><%= stats.traitArray[1][0].split('_')[1] %></li>
                <li><img src="../imgs/traits/bard.png"><%= stats.traitArray[2][0].split('_')[1] %></li>
                
                <!-- TODO: Fix dynamic trait assets
                <li><img src="../imgs/traits/<%=stats.traitArray[0][0].split('_')[1].toLowerCase() %>.png"><%= stats.traitArray[0][0].split('_')[1] %></li>
                <li><img src="../imgs/traits/<%=stats.traitArray[1][0].split('_')[1].toLowerCase() %>.png"><%= stats.traitArray[1][0].split('_')[1] %></li>
                <li><img src="../imgs/traits/<%=stats.traitArray[2][0].split('_')[1].toLowerCase() %>.png"><%= stats.traitArray[2][0].split('_')[1] %></li>
                -->
              </ul>
              <% } else { %>
                <span>Please import matches</span>
              <% } %>
              
            </li>
            <li>
              <h4>Top Augments</h4>
              <% if(stats.traitArray.length > 2) { %>
              <ul class="top-traits">
                <li><img src="../imgs/traits/legend.png"><%= stats.augmentArray[0][0].split('_')[2] %></li>
                <li><img src="../imgs/traits/legend.png"><%= stats.augmentArray[1][0].split('_')[2] %></li>
                <li><img src="../imgs/traits/legend.png"><%= stats.augmentArray[2][0].split('_')[2] %></li>
              </ul>
              <% } else { %>
                <span>Please import matches</span>
              <% } %>
              
            </li>
          </ul>
          
        </div>
      </div>

    <div class="row">
      <div class="col-3">

      </div>
      <div class="col-9">
        <ul class="row list-unstyled match-list">
          <% for(var i=0; i<summonerMatches.length; i++) {%>
          <li>
            <ul class="match-stats">
              <li class="match-placement">
                <span>Rank</span>
                <h2><%= summonerMatches[i].data.placement %></h2>
              </li>
              <li class="summonerMatch unit-list">
                <span>Team</span>
                <ul>
                  <% let sortedUnits = summonerMatches[i].data.units.sort((a,b) => a.rarity.toString().localeCompare(b.rarity.toString()) || a.tier - b.tier) %>
                  <% for(var j=0; j<sortedUnits.length; j++) {%>
                    <% if(sortedUnits[j].rarity === 5) {console.log(sortedUnits[j])} %>
                    <li class="unit-container <%= "rarity-"+sortedUnits[j].rarity %>">
                        <%- "&#9733;".repeat(sortedUnits[j].tier) %>
                        <% let set = "set_" + summonerMatches[i].setNumber %>
                        <img src="<%= assets[set].champions[sortedUnits[j].character_id.split('_')[1].toLowerCase()].assetUrl %>">
                        <p class="<%= (j >= 5) ? "unit-name-top" : "unit-name-bottom" %>"><%= assets[set].champions[sortedUnits[j].character_id.split('_')[1].toLowerCase()].name %></p>
                    </li>
                  <% } %>
                </ul>
              </li>
              <li class="match-trait-list">
                <span>Traits</span>
                <ul>
                  <% let matchTraits = summonerMatches[i].data.traits.sort((a,b) => b.tier_current - a.tier_current) %>
                  <% for(var j=0; j<matchTraits.length; j++) {%>
                    <% if(matchTraits[j].tier_current > 0) { %>
                    <li>
                      <%= matchTraits[j].name.split('_')[1] %> (<%=matchTraits[j].tier_current %>/<%= matchTraits[j].tier_total %>)
                    </li>
                    <% } %>
                  <% } %>
                </ul>
              </li>
              <li class="match-augments">
                <span>Augments</span>
                <ul>
                  <% for(var j=0; j<summonerMatches[i].data.augments.length; j++) { %>
                    <li>
                      <%= summonerMatches[i].data.augments[j].split('_')[2] %>
                    </li>
                  <% } %>
                </ul>
              </li>

            </ul>
          </li>
            <a href="/match/<%= summonerMatches[i].matchId.split('_')[1]%>">
              <%= summonerMatches[i].matchId%>
            </a>
          </li>
          <% } %>
        </ul>
          <div class="row justify-content-center mt-5">
            <a class="btn btn-primary" href="/feed">Return to Feed</a>
          </div>  
        </div>
      </div>  
    </div>
  </div>
  </div>
</div>
<%- include('partials/footer') -%>